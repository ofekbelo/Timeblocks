# Sub-Agent 5.3: Reports

**Parent:** Agent 5 - Features Integration  
**Status:** Ready to Execute  
**Dependencies:** Agent 1-4, Sub-Agent 5.1-5.2  
**Estimated Time:** 2-3 hours  
**Working Directory:** `timeblocks/apps/web/`

---

## üìã Mission

Build comprehensive reporting and analytics features with beautiful charts, date filtering, and exportable data.

---

## üéØ What You'll Build

```
‚úÖ Summary Report
   - Total hours/revenue
   - Week/Month comparisons
   - Top projects
   
‚úÖ Project Breakdown
   - Pie chart of time distribution
   - Bar chart of revenue by project
   - Detailed table
   
‚úÖ Daily/Weekly Trends
   - Line chart of hours over time
   - Compare periods
   
‚úÖ Date Range Picker
   - Quick ranges (Today, This Week, etc.)
   - Custom date selection
```

---

## ‚úÖ Step-by-Step Tasks

### TASK 1: Install Recharts

```bash
cd apps/web
pnpm add recharts
pnpm add -D @types/recharts
```

---

### TASK 2: Create Date Range Picker Component

Create `src/pages/Reports/components/DateRangePicker/DateRangePicker.tsx`:

```typescript
import { useState } from 'react';
import { Button } from '@/components/ui/Button';
import { Card } from '@/components/ui/Card';
import styles from './DateRangePicker.module.scss';

interface DateRange {
  startDate: Date;
  endDate: Date;
}

interface Props {
  value: DateRange;
  onChange: (range: DateRange) => void;
}

export function DateRangePicker({ value, onChange }: Props) {
  const [customMode, setCustomMode] = useState(false);

  const setQuickRange = (days: number) => {
    const endDate = new Date();
    const startDate = new Date();
    startDate.setDate(endDate.getDate() - days);
    onChange({ startDate, endDate });
    setCustomMode(false);
  };

  const handleCustomChange = (type: 'start' | 'end', dateString: string) => {
    const date = new Date(dateString);
    if (type === 'start') {
      onChange({ ...value, startDate: date });
    } else {
      onChange({ ...value, endDate: date });
    }
  };

  return (
    <Card variant="outlined" padding="lg">
      <div className={styles.dateRangePicker}>
        <div className={styles.quickRanges}>
          <Button
            variant="ghost"
            size="sm"
            onClick={() => setQuickRange(0)}
          >
            Today
          </Button>
          <Button
            variant="ghost"
            size="sm"
            onClick={() => setQuickRange(7)}
          >
            Last 7 Days
          </Button>
          <Button
            variant="ghost"
            size="sm"
            onClick={() => setQuickRange(30)}
          >
            Last 30 Days
          </Button>
          <Button
            variant="ghost"
            size="sm"
            onClick={() => setQuickRange(90)}
          >
            Last 90 Days
          </Button>
          <Button
            variant="ghost"
            size="sm"
            onClick={() => setCustomMode(true)}
          >
            Custom
          </Button>
        </div>

        {customMode && (
          <div className={styles.customRange}>
            <div className={styles.field}>
              <label>From</label>
              <input
                type="date"
                value={value.startDate.toISOString().split('T')[0]}
                onChange={(e) => handleCustomChange('start', e.target.value)}
                className={styles.dateInput}
              />
            </div>
            <div className={styles.field}>
              <label>To</label>
              <input
                type="date"
                value={value.endDate.toISOString().split('T')[0]}
                onChange={(e) => handleCustomChange('end', e.target.value)}
                className={styles.dateInput}
              />
            </div>
          </div>
        )}
      </div>
    </Card>
  );
}
```

Create `src/pages/Reports/components/DateRangePicker/DateRangePicker.module.scss`:

```scss
@import '../../../../styles/variables';
@import '../../../../styles/mixins';

.dateRangePicker {
  display: flex;
  flex-direction: column;
  gap: $spacing-md;
}

.quickRanges {
  display: flex;
  gap: $spacing-sm;
  flex-wrap: wrap;
}

.customRange {
  display: grid;
  grid-template-columns: 1fr 1fr;
  gap: $spacing-md;
  padding-top: $spacing-md;
  border-top: 1px solid $color-gray-200;

  @media (max-width: $breakpoint-md) {
    grid-template-columns: 1fr;
  }
}

.field {
  display: flex;
  flex-direction: column;
  gap: $spacing-xs;

  label {
    font-size: $font-size-sm;
    font-weight: $font-weight-medium;
    color: $color-gray-700;
  }
}

.dateInput {
  padding: 0.625rem $spacing-md;
  border: 2px solid $color-gray-300;
  border-radius: $border-radius-md;
  font-size: $font-size-base;
  transition: all $transition-base;

  &:focus {
    outline: none;
    border-color: $color-primary;
    box-shadow: 0 0 0 3px rgba($color-primary, 0.1);
  }
}
```

Create `src/pages/Reports/components/DateRangePicker/index.ts`:

```typescript
export { DateRangePicker } from './DateRangePicker';
```

---

### TASK 3: Create Summary Report Component

Create `src/pages/Reports/components/SummaryReport/SummaryReport.tsx`:

```typescript
import { useMemo } from 'react';
import { useGetTimeEntriesQuery } from '@/store/api/timeEntriesApi';
import { useGetProjectsQuery } from '@/store/api/projectsApi';
import { formatDuration } from '@timeblocks/shared/utils';
import { Card } from '@/components/ui/Card';
import styles from './SummaryReport.module.scss';

interface Props {
  startDate: Date;
  endDate: Date;
}

export function SummaryReport({ startDate, endDate }: Props) {
  const { data: entries = [] } = useGetTimeEntriesQuery();
  const { data: projects = [] } = useGetProjectsQuery();

  const stats = useMemo(() => {
    const filteredEntries = entries.filter((entry) => {
      const entryDate = new Date(entry.startTime);
      return entryDate >= startDate && entryDate <= endDate;
    });

    const totalSeconds = filteredEntries.reduce(
      (sum, entry) => sum + (entry.duration || 0),
      0
    );

    const totalRevenue = filteredEntries.reduce((sum, entry) => {
      const project = projects.find((p) => p.id === entry.projectId);
      if (!project?.hourlyRate) return sum;
      const hours = (entry.duration || 0) / 3600;
      return sum + hours * Number(project.hourlyRate);
    }, 0);

    const projectsWorked = new Set(filteredEntries.map((e) => e.projectId)).size;

    const avgPerDay =
      totalSeconds / Math.max(1, Math.ceil((endDate.getTime() - startDate.getTime()) / (1000 * 60 * 60 * 24)));

    return {
      totalTime: formatDuration(totalSeconds),
      totalRevenue: totalRevenue.toFixed(2),
      entriesCount: filteredEntries.length,
      projectsWorked,
      avgPerDay: formatDuration(avgPerDay),
    };
  }, [entries, projects, startDate, endDate]);

  return (
    <div className={styles.summaryReport}>
      <h2>Summary</h2>
      <div className={styles.grid}>
        <Card variant="elevated" padding="lg">
          <div className={styles.stat}>
            <div className={styles.value}>{stats.totalTime}</div>
            <div className={styles.label}>Total Time</div>
          </div>
        </Card>

        <Card variant="elevated" padding="lg">
          <div className={styles.stat}>
            <div className={styles.value}>${stats.totalRevenue}</div>
            <div className={styles.label}>Total Revenue</div>
          </div>
        </Card>

        <Card variant="elevated" padding="lg">
          <div className={styles.stat}>
            <div className={styles.value}>{stats.projectsWorked}</div>
            <div className={styles.label}>Projects</div>
          </div>
        </Card>

        <Card variant="elevated" padding="lg">
          <div className={styles.stat}>
            <div className={styles.value}>{stats.avgPerDay}</div>
            <div className={styles.label}>Avg per Day</div>
          </div>
        </Card>
      </div>
    </div>
  );
}
```

Create `src/pages/Reports/components/SummaryReport/SummaryReport.module.scss`:

```scss
@import '../../../../styles/variables';
@import '../../../../styles/mixins';

.summaryReport {
  h2 {
    font-size: $font-size-xl;
    margin-bottom: $spacing-lg;
  }
}

.grid {
  display: grid;
  grid-template-columns: repeat(auto-fit, minmax(200px, 1fr));
  gap: $spacing-lg;
}

.stat {
  text-align: center;
}

.value {
  font-size: $font-size-3xl;
  font-weight: $font-weight-bold;
  color: $color-primary;
  margin-bottom: $spacing-xs;
  font-variant-numeric: tabular-nums;
}

.label {
  font-size: $font-size-sm;
  color: $color-gray-600;
  text-transform: uppercase;
  letter-spacing: 0.5px;
}
```

Create `src/pages/Reports/components/SummaryReport/index.ts`:

```typescript
export { SummaryReport } from './SummaryReport';
```

---

### TASK 4: Create Project Breakdown Component

Create `src/pages/Reports/components/ProjectBreakdown/ProjectBreakdown.tsx`:

```typescript
import { useMemo } from 'react';
import { PieChart, Pie, Cell, ResponsiveContainer, Legend, Tooltip } from 'recharts';
import { useGetTimeEntriesQuery } from '@/store/api/timeEntriesApi';
import { useGetProjectsQuery } from '@/store/api/projectsApi';
import { formatDuration } from '@timeblocks/shared/utils';
import { Card } from '@/components/ui/Card';
import styles from './ProjectBreakdown.module.scss';

interface Props {
  startDate: Date;
  endDate: Date;
}

export function ProjectBreakdown({ startDate, endDate }: Props) {
  const { data: entries = [] } = useGetTimeEntriesQuery();
  const { data: projects = [] } = useGetProjectsQuery();

  const chartData = useMemo(() => {
    const filteredEntries = entries.filter((entry) => {
      const entryDate = new Date(entry.startTime);
      return entryDate >= startDate && entryDate <= endDate;
    });

    const projectTime = new Map<string, number>();

    filteredEntries.forEach((entry) => {
      const current = projectTime.get(entry.projectId) || 0;
      projectTime.set(entry.projectId, current + (entry.duration || 0));
    });

    return Array.from(projectTime.entries()).map(([projectId, seconds]) => {
      const project = projects.find((p) => p.id === projectId);
      return {
        name: project?.name || 'Unknown',
        value: seconds / 3600, // Convert to hours
        color: project?.color || '#4A90E2',
        formattedValue: formatDuration(seconds),
      };
    }).sort((a, b) => b.value - a.value);
  }, [entries, projects, startDate, endDate]);

  if (chartData.length === 0) {
    return (
      <Card>
        <div className={styles.empty}>
          <p>No data for selected period</p>
        </div>
      </Card>
    );
  }

  return (
    <div className={styles.projectBreakdown}>
      <h2>Time by Project</h2>
      <Card variant="outlined" padding="lg">
        <ResponsiveContainer width="100%" height={400}>
          <PieChart>
            <Pie
              data={chartData}
              dataKey="value"
              nameKey="name"
              cx="50%"
              cy="50%"
              outerRadius={120}
              label={(entry) => `${entry.name}: ${entry.formattedValue}`}
            >
              {chartData.map((entry, index) => (
                <Cell key={`cell-${index}`} fill={entry.color} />
              ))}
            </Pie>
            <Tooltip
              formatter={(value: number) => `${value.toFixed(1)} hours`}
            />
            <Legend />
          </PieChart>
        </ResponsiveContainer>
      </Card>

      <Card variant="outlined" padding="lg">
        <table className={styles.table}>
          <thead>
            <tr>
              <th>Project</th>
              <th>Time</th>
              <th>Percentage</th>
            </tr>
          </thead>
          <tbody>
            {chartData.map((item, index) => {
              const total = chartData.reduce((sum, d) => sum + d.value, 0);
              const percentage = ((item.value / total) * 100).toFixed(1);
              return (
                <tr key={index}>
                  <td>
                    <div className={styles.projectName}>
                      <div
                        className={styles.colorDot}
                        style={{ backgroundColor: item.color }}
                      />
                      {item.name}
                    </div>
                  </td>
                  <td>{item.formattedValue}</td>
                  <td>{percentage}%</td>
                </tr>
              );
            })}
          </tbody>
        </table>
      </Card>
    </div>
  );
}
```

Create `src/pages/Reports/components/ProjectBreakdown/ProjectBreakdown.module.scss`:

```scss
@import '../../../../styles/variables';
@import '../../../../styles/mixins';

.projectBreakdown {
  h2 {
    font-size: $font-size-xl;
    margin-bottom: $spacing-lg;
  }
}

.empty {
  @include flex-center;
  padding: $spacing-3xl;
  color: $color-gray-600;
}

.table {
  width: 100%;
  border-collapse: collapse;

  th {
    text-align: left;
    padding: $spacing-md;
    border-bottom: 2px solid $color-gray-300;
    font-weight: $font-weight-semibold;
    color: $color-gray-700;
  }

  td {
    padding: $spacing-md;
    border-bottom: 1px solid $color-gray-200;
  }

  tbody tr:hover {
    background-color: $color-gray-50;
  }
}

.projectName {
  display: flex;
  align-items: center;
  gap: $spacing-sm;
}

.colorDot {
  width: 12px;
  height: 12px;
  border-radius: 50%;
  flex-shrink: 0;
}
```

Create `src/pages/Reports/components/ProjectBreakdown/index.ts`:

```typescript
export { ProjectBreakdown } from './ProjectBreakdown';
```

---

### TASK 5: Create Reports Page

Create `src/pages/Reports/Reports.tsx`:

```typescript
import { useState } from 'react';
import { DateRangePicker } from './components/DateRangePicker';
import { SummaryReport } from './components/SummaryReport';
import { ProjectBreakdown } from './components/ProjectBreakdown';
import styles from './Reports.module.scss';

export function Reports() {
  const [dateRange, setDateRange] = useState({
    startDate: new Date(new Date().setDate(new Date().getDate() - 30)),
    endDate: new Date(),
  });

  return (
    <div className={styles.reportsPage}>
      <div className={styles.header}>
        <div>
          <h1>Reports & Analytics</h1>
          <p>Analyze your time tracking data</p>
        </div>
      </div>

      <DateRangePicker value={dateRange} onChange={setDateRange} />

      <div className={styles.section}>
        <SummaryReport
          startDate={dateRange.startDate}
          endDate={dateRange.endDate}
        />
      </div>

      <div className={styles.section}>
        <ProjectBreakdown
          startDate={dateRange.startDate}
          endDate={dateRange.endDate}
        />
      </div>
    </div>
  );
}
```

Create `src/pages/Reports/Reports.module.scss`:

```scss
@import '../../styles/variables';
@import '../../styles/mixins';

.reportsPage {
  max-width: 1200px;
  margin: 0 auto;
}

.header {
  margin-bottom: $spacing-xl;

  h1 {
    font-size: $font-size-3xl;
    margin-bottom: $spacing-xs;
  }

  p {
    color: $color-gray-600;
  }
}

.section {
  margin-top: $spacing-xl;
}
```

Create `src/pages/Reports/index.ts`:

```typescript
export { Reports } from './Reports';
```

---

### TASK 6: Update Router

Update `src/router/index.tsx`:

```typescript
import { createBrowserRouter, Navigate } from 'react-router-dom';
import { RootLayout } from '@/layouts/RootLayout/RootLayout';
import { AuthLayout } from '@/layouts/AuthLayout/AuthLayout';
import { ProtectedRoute } from '@/components/common/ProtectedRoute';
import { Login } from '@/pages/auth/Login';
import { Register } from '@/pages/auth/Register';
import { Dashboard } from '@/pages/Dashboard/Dashboard';
import { Timer } from '@/pages/Timer';
import { ProjectsList } from '@/pages/Projects/ProjectsList';
import { ProjectForm } from '@/pages/Projects/ProjectForm';
import { ClientsList } from '@/pages/Clients/ClientsList';
import { Reports } from '@/pages/Reports'; // Add this

export const router = createBrowserRouter([
  {
    path: '/auth',
    element: <AuthLayout />,
    children: [
      { index: true, element: <Navigate to="/auth/login" replace /> },
      { path: 'login', element: <Login /> },
      { path: 'register', element: <Register /> },
    ],
  },
  {
    path: '/',
    element: <ProtectedRoute />,
    children: [
      {
        element: <RootLayout />,
        children: [
          { index: true, element: <Dashboard /> },
          { path: 'timer', element: <Timer /> },
          { path: 'projects', element: <ProjectsList /> },
          { path: 'projects/new', element: <ProjectForm /> },
          { path: 'projects/:id/edit', element: <ProjectForm /> },
          { path: 'clients', element: <ClientsList /> },
          { path: 'clients/new', element: <div>Client Form (Coming Soon)</div> },
          { path: 'time-entries', element: <div>Time Entries (Coming Soon)</div> },
          { path: 'reports', element: <Reports /> }, // Add this
          { path: 'settings', element: <div>Settings (Coming Soon)</div> },
        ],
      },
    ],
  },
  {
    path: '*',
    element: <Navigate to="/" replace />,
  },
]);
```

---

### TASK 7: Test Reports

```bash
# Make sure backend is running
cd apps/server
pnpm dev

# Start frontend
cd apps/web
pnpm dev

# Open http://localhost:5173/reports
```

**Test flows:**
1. View default report (last 30 days)
2. Try quick ranges (Today, Last 7 Days, etc.)
3. Try custom date range
4. View pie chart
5. Check summary stats
6. View breakdown table

---

## ‚úÖ Verification

### Reports Display
- [ ] Summary stats show correctly
- [ ] Pie chart renders
- [ ] Table shows all projects
- [ ] Colors match projects

### Date Filtering
- [ ] Quick ranges work
- [ ] Custom dates work
- [ ] Data updates when range changes

### Calculations
- [ ] Total time accurate
- [ ] Revenue calculated correctly
- [ ] Percentages add up to 100%
- [ ] Avg per day makes sense

### UI/UX
- [ ] Charts are responsive
- [ ] Loading states (if needed)
- [ ] Empty states show
- [ ] Tooltips work
- [ ] Legend displays

---

## ‚úÖ Success Criteria

- [ ] Recharts installed
- [ ] Date range picker working
- [ ] Summary report displays
- [ ] Project breakdown chart displays
- [ ] Data calculations accurate
- [ ] Responsive design
- [ ] No console errors
- [ ] All TypeScript types correct

---

## üìä What We Built

```
‚úÖ Reports Page
   - Date range picker
   - Summary statistics
   - Project breakdown chart
   - Detailed table
   
‚úÖ Charts (Recharts)
   - Pie chart for time distribution
   - Responsive design
   - Custom colors
   - Tooltips
   
‚úÖ Analytics
   - Total time/revenue
   - Projects worked
   - Daily averages
   - Percentages
```

---

## ‚û°Ô∏è Next Steps

Agent 5 Complete! üéâ

All features are now integrated:
- ‚úÖ Timer feature
- ‚úÖ Projects management
- ‚úÖ Clients management
- ‚úÖ Reports & analytics

**Next Agents:**
- **Agent 6: Email Service** (verification emails, notifications)
- **Agent 7: Mobile App** (React Native)
- **Agent 8: Testing** (comprehensive test suite)

---

**Reports complete! üìä Analytics ready! üìà**